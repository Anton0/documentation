{{ define "api-main" }}

    {{ $dot := . }}

    {{ .Scratch.Set "apiVersion" "v1"}}

    {{ if in .Permalink "api/v2" }}
        {{ .Scratch.Set "apiVersion" "v2"}}
    {{ end }}

    {{ $apiVersion := .Scratch.Get "apiVersion"}}

    {{ $d := index $dot.Site.Data.api $apiVersion "full_spec" }}

    {{ $snipdir := print "content/en/api/" $apiVersion "/examples/" }}

    {{- $files := readDir $snipdir -}}

    {{ range $k, $v := (index $d "tags") }}
        {{ if eq $.Params.title $v.name }}
            {{ range $path_key, $path_object := $d.paths }}

                {{ $.Scratch.Set "pathObject" (slice)}}
                {{ range $action_type, $action := $path_object }}

                    {{ $.Scratch.Add "pathObject" (dict "actionType" $action_type "action" $action ) }}

                {{ end }}

                {{ $pathObject := $.Scratch.Get "pathObject" }}

                {{ range sort $pathObject "action.summary" "asc"  }}


                    {{ $act := .action }}

                    {{ if in .action.tags $v.name }}
                        <div class="row">
                            <div class="col-7">
                                <h2 class="mb-2" id="{{ .action.summary | urlize }}">
                                    <a href="#{{ .action.summary | urlize }}">{{ .action.summary }}</a>
                                </h2>
                                <p><span class="text-uppercase font-semibold">{{ .actionType }}</span>&nbsp; &nbsp;<span>{{$path_key}}</span></p>
                                
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-7">
                                {{.action.description | markdownify }}
                            </div>
                            <div class="col-5">
                        
                                 
                                    {{ range $files }}

                                        {{ $file := (print $snipdir (.Name))}}
                                        {{ $file_content := readFile $file }}
                                        {{ $file_basename := (index (split .Name ".") 0) }}
                                        {{ $file_extension := index (split (path.Ext $file) ".") 1 }}

                                        {{ if eq $act.operationId $file_basename }}
                                            {{ $lang := index $dot.Site.Data.highlighting.languages $file_extension }}

                                            <div class="{{if eq $file_extension "sh"}}d-block{{else}}d-none{{end}} js-code-block code-block-{{ $lang.pygments_name }}">{{ highlight $file_content $lang.pygments_name "" }}</div>
                                    
                                        {{ end }}
                                    {{ end }}
                                    
                            
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <hr/>
                            </div>
                        </div>
                    {{ end }}                
                {{ end }}
            {{ end }}
        {{ end }}
    {{ end }}
{{ end }}