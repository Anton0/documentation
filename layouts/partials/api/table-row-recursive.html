{{ $dot := .}}
{{ $d := .context.Site.Data.api.v1.full_spec_deref }}
{{ range $key, $value := .data }}

    {{/*
        We actually only care about properties not items, however properties appear inside items.
        So only pass .items.properties when we have .items
    */}}

    {{ $s := newScratch }}
    {{ if reflect.IsMap $value }}
      {{ with $value.properties }}
        {{ $s.Set "data" . }}
      {{ end }}
      {{ with $value.items }}
          {{ with .properties }}
            {{ $s.Set "data" . }}
          {{ else }}
            {{ $s.Set "data" . }}
          {{ end }}
      {{ end }}
    {{ end }}
    {{ $childData := ($s.Get "data") }}

    <tr class="{{ if $childData }}has-nested{{ end }} {{if eq $dot.isNested true}}nested{{end}}">
        <td>{{ if $childData }}<span style="cursor: pointer; font-size: 18px">> &nbsp;</span>{{ end }}{{ $key }}</td>
        {{ if reflect.IsMap $value }}
          <td>{{ with $value.type }}{{ . }}{{ end }}</td>
          <td>
            {{ with $value.description }}
              {{ if reflect.IsMap . }}
              {{ else }}
                {{ . | markdownify }}
              {{ end }}
            {{ end }}
          </td>
        {{ else }}
          <td>&nbsp;</td>
          <td>&nbsp;{{ $value }}</td>
        {{ end }}
    </tr>

    {{ partial "api/table-row-recursive.html" (dict "context" $dot.context "data" $childData "isNested" true) }}

{{ end }}
